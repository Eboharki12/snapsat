{% extends "base.jinja2" %}

{% block scripts %}
    <script src="http://d3js.org/d3.v3.js"></script>
    <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
    <script type='text/javascript' src='/static/js/spectrum_bars.js'></script>
    <script src='https://api.tiles.mapbox.com/mapbox.js/v2.1.6/mapbox.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox.js/v2.1.6/mapbox.css' rel='stylesheet' />
{% endblock %}

{% block content %}

    <section class='mbx'>
        
    </section>

    <section class='mbx'>
        <section id="scene_info">
            <style>
                #column_two{
                    vertical-align: top
                }
            </style>
            <div id="overview_image" class="display-inline-block">
                <img src="{{ meta_data.overview_url }}">
            </div>
            <div id="column_two" class="display-inline-block">
                <div id="metadata">
                    <table>
                        <thead class='group_head'><tr><th class="light uppercase h2">Metadata</th></tr></thead>
                        <tr><td>ID:</td><td>{{ meta_data.scene_id }}</td></tr>
                        <tr><td>Acquistion Date and Time:</td><td>{{ meta_data.acquisitiondate }}</td></tr>
                        <tr><td>Cloud Cover:</td><td>{{ meta_data.cloudcover }}%</td></tr>
                        <tr><td>Minimum/Maximum Latitude:</td><td>{{ meta_data.min_lat }}/{{ meta_data.max_lat }}</td></tr>
                        <tr><td>Minimum/Maximum Longitude:</td><td>{{ meta_data.min_lon }}/{{ meta_data.max_lon }}</td></tr>
                    </table>
                </div>
                <div>
                    <table>
                    <h2>Generate a new image</h2>
                        <form method="post" id="request_form_{{meta_data.scene_id}}">
                            <div id='combinations'>
                                <select name='band1' id='band1' required>
                                    <option selected value=''>Select Red Band</option>
                                </select>
                                <select name='band2' id='band2' required>
                                    <option selected value=''>Select Green Band</option>
                                </select>
                                <select name='band3' id='band3' required>
                                    <option selected value=''>Select Blue Band</option>
                                </select>
                            </div>

                            <div class='inline-block clearfix'>
                                <button form="request_form_{{meta_data.scene_id}}" formaction="/request_preview/{{meta_data.scene_id}}" formmethod="post" type="submit" class="left button rounded-left">Render Preview</button>
                            </div>
                        </form>
                    </table>
                </div>
            </div>
        </section>
        <div class='graph' id='reference'></div>
        <div class='preview-container'>
            {% for band_combo, composite in composites.iteritems() %}
                <div class='preview' id='{{ band_combo }}'>
                    <h2 class='composite-description mbn'>
                        <span class='band-red'>{{ composite.band1 }}</span>
                        <span class='band-green'>{{ composite.band2 }}</span> 
                        <span class='band-blue'>{{ composite.band3 }}</span>
                    </h2>
                    <div class='graph' id='graph{{composite.previewjobid}}'></div>
                    <div id='{{composite.previewjobid}}'>
                        {% if composite.previewurl %}
                            <a href="{{ composite.preview }}"><img src="{{ composite.previewurl }}"></a>
                        {% else %}
                            <div class='nopreview' id='{{composite.previewjobid}}'>
                                <div class="loading"><img src="/static/img/no_preview.gif"></div>
                            </div> <!-- nopreview -->
                        {% endif %}
                    </div> <!-- composite.previewjobid -->
                    {% if composite.fullurl %}
                        <p>Current status: <strong class='red'><a href="{{ composite.fullurl }}">{{ composite.fullstatus }}! Download Full Zip</a></strong></p>
                    {% else %}
                        <div class='nofull' id='{{composite.fulljobid}}'>
                            {% if composite.fullstatus %}
                                 <p>Current status: <strong class='red'><span id='fullstatus'>{{ composite.fullstatus }}</span></strong></p>
                                {% if composite.elapsed_time %}
                                    <p>Elapsed Process Time (hr:min:sec): <span id='fullelapsedtime'>{{ composite.elapsed_time }}</span></p>
                                {% endif %}
                            {% else %}
                                <p>
                                    <strong class='red'>
                                        <form method="post">
                                            <input type="hidden" name='band1' value="{{ composite.band1 }}"/>
                                            <input type="hidden" name='band2' value="{{ composite.band2 }}"/>
                                            <input type="hidden" name='band3' value="{{ composite.band3 }}"/>
                                            <button formaction="/request_composite/{{scene_id}}" formmethod="post" type="submit">Click here to request a full render!</button>
                                        </form>
                                    </strong>
                                </p>
                            {% endif %}
                        </div> <!-- nofull -->
                    {% endif %}
                </div> <!-- preview -->
            {% endfor %}
        </div> <!-- preview-container -->
    </section>

    <script type='text/javascript' src='/static/js/band.js'></script>

{% endblock %}
