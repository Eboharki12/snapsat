{% extends "base.jinja2" %}

{% block scripts %}
    <script src='https://api.tiles.mapbox.com/mapbox.js/v2.1.6/mapbox.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox.js/v2.1.6/mapbox.css' rel='stylesheet' />
{% endblock %}

{% block content %}

    <section class='mbx'>
        <h3 class='mbn red'>3</h3>
        <h2>Preview your selection: {{ scene_id }}</h2>
        <div class='preview-container'>
            {% for band_combo, composite in composites.iteritems() %}
                <div class='preview'>
                    <h3 class='composite-description'>{{ composite.band1 }} {{ composite.band2 }} {{ composite.band3 }}</h3>
                    <div class='nopreview' id='{{composite.previewjobid}}'>
                        {% if composite.previewurl %}
                            <img src="{{ composite.previewurl }}">
                        {% else %}
                            <img src="/static/img/no_preview.png">
                        {% endif %}
                    </div>

                    {% if composite.fullurl %}
                        <p>Current status: <strong class='red'><a href="{{ composite.fullurl }}">{{ composite.fullstatus }}! Download Full Zip</a></strong></p>
                    {% else %}
                        <div class='nofull' id='{{composite.fulljobid}}'>
                            {% if composite.fullstatus %}
                                 <p>Current status: <strong class='red'><span id='fullstatus'>{{ composite.fullstatus }}</span></strong></p>
                                {% if composite.elapsed_time %}
                                    <p>Elapsed Process Time (hr:min:sec): <span id='fullelapsedtime'>{{ composite.elapsed_time }}</span></p>
                                {% endif %}
                            {% else %}
                                <p>Current status: <strong class='red'>No one has requested the full composite of this band combination. Be the first!</strong></p>
                            {% endif %}
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    </section>

    <section class='mbx'>
        <h3 class='mbn red'>4</h3>
        <h2>Generate a new image</h2>
        <form method="post" id="request_form_{{scene_id}}">
            <div id='combinations'>
                <select name='band1' id='band1'></select>
                <select name='band2' id='band2'></select>
                <select name='band3' id='band3'></select>
            </div>

            <div class='inline-block clearfix'>
                <button form="request_form_{{scene_id}}" formaction="/request_preview/{{scene_id}}" formmethod="post" type="submit" class="left button rounded-left">Render Preview</button>
                <button form="request_form_{{scene_id}}" formaction="/request_composite/{{scene_id}}" formmethod="post" type="submit" class="left button rounded-right">Render Full Image</button>
            </div>
        </form>
    </section>
    <script>
        $("#band1").on('focus', function (){
            $("#band1").empty()
            var existingValues = [parseInt($("#band2").val()), parseInt($("#band3").val()), 8];
            console.log(existingValues);
            for (i=1; i < 10; i++) {
                if ($.inArray(i, existingValues) < 0) {
                    $("#band1").append("<option value='" + i + "'>" + i + "</option>")
                }
            }
        });
        $("#band2").on('focus', function (){
            $("#band2").empty()
            var existingValues = [parseInt($("#band1").val()), parseInt($("#band3").val()), 8];
            console.log(existingValues);
            for (i=1; i < 10; i++) {
                if ($.inArray(i, existingValues) < 0) {
                    $("#band2").append("<option value='" + i + "'>" + i + "</option>")
                }
            }
        });
        $("#band3").on('focus', function (){
            $("#band3").empty()
            var existingValues = [parseInt($("#band1").val()), parseInt($("#band2").val()), 8];
            console.log(existingValues);
            for (i=1; i < 10; i++) {
                if ($.inArray(i, existingValues) < 0) {
                    $("#band3").append("<option value='" + i + "'>" + i + "</option>")
                }
            }
        });
    </script>

{% endblock %}
