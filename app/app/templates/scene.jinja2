{% extends "base.jinja2" %}

{% block scripts %}
<script src="http://d3js.org/d3.v3.js"></script>
<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
<script type='text/javascript' src='/static/js/spectrum_bars.js'></script>
<script type='text/javascript' src='/static/js/longpoll.js'></script>
{% endblock %}

{% block title %}
<title>{{ meta_data.scene_id }} | Snapsat</title>
{% endblock %}

{% block styles %}
<style>
    .scene-meta {
        position: absolute;
        top: 49%;
        z-index: 9999;
        background: rgba(0, 0, 0, 0.4);
        padding: 2rem;
    }
</style>
{% endblock %}

{% block content %}

<div class='container clearfix mt4'>
    <div class='center mb4'>
        <h1 class='mb0'>Your selection</h1>
        <p class='h3'>Create image composites of the scene you selected.</p>
    </div>
    <div class='mb4'>

        <!-- <div class='sm-col sm-col-6'> -->
        <div>
            <table class='table-light mb4'>
                <thead>
                    <tr><th>ID</th><th>Date acquired</th><th>Cloud cover</th><th>Boundaries</th></tr>
                </thead>
                <tbody>
                    <tr>
                        <td>{{ meta_data.scene_id }}</td>
                        <td>{{ meta_data.acquisitiondate }}</td>
                        <td>{{ meta_data.cloudcover }}</td>
                        <td>{{ meta_data.max_lat }} {{ meta_data.min_lon }} {{ meta_data.min_lat }} {{ meta_data.max_lon }}</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- <div class='sm-col sm-col-6'> -->
        <div class='col-8 mx-auto center'>
            <h2 class='center'>Create a preview</h2>
            <p>The fastest way to create a preview of your scene is by using one of our prebuilt templates.</p>
            <section id='scene_info'>
                <!-- Use a prebuilt, common combination. -->
                <div id='generate'>
                    <div class='inline-block clearfix'>
                        <form method="post" class='inline left'>
                            <input type="hidden" name='band1' value="4"/>
                            <input type="hidden" name='band2' value="3"/>
                            <input type="hidden" name='band3' value="2"/>
                            <button class='button rounded-left' formaction="/request_preview/{{meta_data.scene_id}}" formmethod="post" type="submit">Natural Color</button>
                        </form>
                        <form method="post" class='inline left'>
                            <input type="hidden" name='band1' value="2"/>
                            <input type="hidden" name='band2' value="5"/>
                            <input type="hidden" name='band3' value="9"/>
                            <button class='button not-rounded' formaction="/request_preview/{{meta_data.scene_id}}" formmethod="post" type="submit">Clouds</button>
                        </form>
                        <form method="post" class='inline left'>
                            <input type="hidden" name='band1' value="5"/>
                            <input type="hidden" name='band2' value="6"/>
                            <input type="hidden" name='band3' value="4"/>
                            <button class='button not-rounded' formaction="/request_preview/{{meta_data.scene_id}}" formmethod="post" type="submit">Land/Water Delination</button>
                        </form>
                        <form method="post" class='inline left'>
                            <input type="hidden" name='band1' value="7"/>
                            <input type="hidden" name='band2' value="6"/>
                            <input type="hidden" name='band3' value="4"/>
                            <button class='button rounded-right' formaction="/request_preview/{{meta_data.scene_id}}" formmethod="post" type="submit">Urban</button>
                        </form>
                    </div>
                </div> <!-- Prebuilt combinations -->

                <!-- Create a custom combination with any available band. -->
                <p>Roll your own custom band combination.</p>
                <form method="post" id="request_form_{{meta_data.scene_id}}">
                    <div id='combinations'>
                        <select class='field-light rounded-left' name='band1' id='band1' required>
                            <option selected value=''>Red Band</option>
                        </select>
                        <select class='field-light not-rounded' name='band2' id='band2' required>
                            <option selected value=''>Green Band</option>
                        </select>
                        <select class='field-light rounded-right' name='band3' id='band3' required>
                            <option selected value=''>Blue Band</option>
                        </select>
                        <button class='button' form="request_form_{{meta_data.scene_id}}" formaction="/request_preview/{{meta_data.scene_id}}" formmethod="post" type="submit">Render!</button>
                    </div>
                </form>
                <script type='text/javascript' src='/static/js/band.js'></script>
            </section> <!-- Scene info -->

        </div>
    </div>
</div>

{% if composites %}
<h2 class='center'>Check out these existing previews</h2>
{% endif %}

<div class='preview-container clearfix px4'>

    {% for band_combo, composite in composites.iteritems() %}
    <div class='preview sm-col sm-col-3 relative' id='{{ band_combo }}'>
        <div class='scene-meta'>
            <h3 class='composite-description'>
                <span class='band-red red'>{{ composite.band1 }}</span>
                <span class='band-green green'>{{ composite.band2 }}</span> 
                <span class='band-blue blue'>{{ composite.band3 }}</span>
            </h3>

            {% if composite.fullurl %}
            <p class='button button-transparent'>Status: <strong class='red'><a href="{{ composite.fullurl }}">{{ composite.fullstatus }}! Download Full Zip</a></strong></p>

            <!-- If a full render has NOT been created, display a means of creating one. -->
            {% else %}
            <div class='nofull' id='{{composite.fulljobid}}'>

                <!-- If a full has been requested, display the processing status. -->
                {% if composite.fullstatus %}
                <p>Current status: <strong class='red'><span id='fullstatus'>{{ composite.fullstatus }}</span></strong></p>
                {% if composite.elapsed_time %}
                <p>Elapsed Process Time (hr:min:sec): <span id='fullelapsedtime'>{{ composite.elapsed_time }}</span></p>
                {% endif %}

                <!-- Display a button that causes a full render to be queued. -->
                {% else %}
                <p>
                    <form method="post">
                        <input type="hidden" name='band1' value="{{ composite.band1 }}"/>
                        <input type="hidden" name='band2' value="{{ composite.band2 }}"/>
                        <input type="hidden" name='band3' value="{{ composite.band3 }}"/>
                        <button formaction="/request_composite/{{ meta_data.scene_id }}" formmethod="post" type="submit">Request a full render.</button>
                    </form>
                </p>
                {% endif %}
                <!-- If a full render has already been created, provide a download link to it. -->
            </div> <!-- nofull -->
            {% endif %}

        </div>

        <!-- Scene barcode visualization -->
        <div class='graph' id='graph{{composite.previewjobid}}'></div>

        <div id='{{composite.previewjobid}}'>
            {% if composite.previewurl %}
            <a href="{{ composite.previewurl }}">
                <img src="{{ composite.previewurl }}">
            </a>
            {% else %}
            <div class='nopreview' id='{{composite.previewjobid}}'>
                <img src="/static/img/loading.gif">
            </div>
            {% endif %}
        </div>
        <!-- Display a preview or loading image -->

    </div> <!-- preview -->
    {% endfor %}
</div> <!-- preview-container -->


{% endblock %}
